<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Classement Live - Presta'Puce</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
        .score-card { background: #2c3e50; margin: 10px auto; padding: 15px; border-radius: 15px; max-width: 500px; display: flex; align-items: center; justify-content: space-between; border-left: 10px solid #3498db; }
        .avatar-circle { width: 50px; height: 50px; border-radius: 50%; background: #34495e; display: flex; align-items: center; justify-content: center; overflow: hidden; font-size: 1.5rem; margin-right: 15px; flex-shrink: 0; }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }
        .player-info { flex-grow: 1; text-align: left; }
        .pts { font-size: 1.8rem; font-weight: bold; color: #f1c40f; }
    </style>
</head>
<body>
    <h1 id="title">CLASSEMENT LIVE</h1>
    <div id="leaderboard">Chargement...</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAf1Vl_O8SHJeFjHavKBJgUFGGy73I8t-o",
            databaseURL: "https://prestapuce-buzz-default-rtdb.europe-west1.firebasedatabase.app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const urlParams = new URLSearchParams(window.location.search);
        const roomID = urlParams.get('room');

        if(roomID) {
            db.ref('roomsData/' + roomID + '/scores').on('value', snap => {
                const data = snap.val() || {};
                const players = Object.keys(data)
                    .map(p => ({ name: p, ...data[p] }))
                    .filter(p => p.active !== false)
                    .sort((a, b) => b.pts - a.pts);

                const container = document.getElementById('leaderboard');
                container.innerHTML = "";
                players.forEach(p => {
                    // Logique d'affichage intelligente de l'avatar
                    let avatarHtml = p.avatar;
                    if(p.avatar && p.avatar.startsWith('data:image')) {
                        avatarHtml = `<img src="${p.avatar}">`;
                    }

                    container.innerHTML += `
                        <div class="score-card">
                            <div class="avatar-circle">${avatarHtml}</div>
                            <div class="player-info">
                                <b style="font-size:1.2rem">${p.name}</b><br>
                                <small>${p.teamName || 'Solo'}</small>
                            </div>
                            <div class="pts">${p.pts} <small>pts</small></div>
                        </div>`;
                });
            });
        }
    </script>
</body>
</html>